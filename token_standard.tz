storage (pair (map address nat) (pair string (pair string nat)));parameter bytes;code{NIL operation;SWAP;UNPAIR;DIP{PAIR};UNPACK (pair address (pair nat (pair bool bytes)));IF_NONE{PUSH string "Failed to unpack bytes";FAILWITH}{};PAIR;NONE nat;NONE nat;PAIR;PAIR;DUP;CDDAAR;DIP{SENDER;};SWAP;MEM;PUSH bool True;CMPNEQ;IF{PUSH string "No token balance found";FAILWITH}{};DUP;CDDAAR;DIP{SENDER;};SWAP;GET;IF_NONE{PUSH string "Key not found in map";FAILWITH}{};SOME;SWAP;SET_CAAR;DUP;CAAR;IF_NONE{PUSH string "Local variable has no value yet: senderBalance";FAILWITH}{};DIP{DUP;CDADAR;};CMPLT;IF{PUSH string "Balance is to low";FAILWITH}{};PUSH nat 0;SOME;SWAP;SET_CADR;DUP;CDDAAR;DIP{DUP;CDAAR;};SWAP;MEM;PUSH bool True;CMPEQ;IF{DUP;CDDAAR;DIP{DUP;CDAAR;};SWAP;GET;IF_NONE{PUSH string "Key not found in map";FAILWITH}{};SOME;SWAP;SET_CADR;}{};DUP;CAAR;IF_NONE{PUSH string "Local variable has no value yet: senderBalance";FAILWITH}{};DIP{DUP;CDADAR;};SUB;SOME;SWAP;SET_CAAR;DUP;CAAR;IF_NONE{PUSH string "Local variable has no value yet: senderBalance";FAILWITH}{};ABS;SOME;SWAP;SET_CAAR;DUP;CADR;IF_NONE{PUSH string "Local variable has no value yet: receiverBalance";FAILWITH}{};DIP{DUP;CDADAR;};ADD;SOME;SWAP;SET_CADR;DUP;CDDAAR;DIP{SENDER;};SWAP;DIIP{DUP;CAAR;IF_NONE{PUSH string "Local variable has no value yet: senderBalance";FAILWITH}{};SOME};DIP{SWAP};UPDATE;SWAP;SET_CDDAAR;DUP;CDDAAR;DIP{DUP;CDAAR;};SWAP;DIIP{DUP;CADR;IF_NONE{PUSH string "Local variable has no value yet: receiverBalance";FAILWITH}{};SOME};DIP{SWAP};UPDATE;SWAP;SET_CDDAAR;DUP;CDADDAR;PUSH bool True;CMPEQ;IF{DUP;CDADDDR;DIP{PUSH mutez 0;};DIIP{DUP;CDAAR;CONTRACT bytes;IF_NONE{PUSH string "Unable to get contract";FAILWITH}{}};TRANSFER_TOKENS;DROP}{};CDR;CDR;UNPAIR;SWAP;PAIR};
